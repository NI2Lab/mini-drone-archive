# Free_V_drone
-구성원 : 방현태, 이윤소, 김나연

2023 미니드론 자율주행 경진대회
---------------------  
-주최: 대한전기학회  
-주관: 대한전기학회 정보 및 제어 부문회  
-일시: 2023년 7월 13일  
![대회환경](./경기장.png)

## Getting Started

Matlab의 툴박스를 사용하여 Tello 드론을 제어하는 시스템으로 전방의 단안 카메라를 사용하여 환경을 식별하고 드론의 움직임을 결정하였다.

### Requirements
- Matlab
- MATLAB Support Package for Ryze Tello Drones
- MATLAB Image Processing Toolbox

### Source Code
코드는 각각의 역할에 따라 모듈화를 수행하였다. 실행파일, 카메라 기반의 목표점 탐색 파일, 목표점 이동 및 마커 인식 파일, error에 따른 이동 계산 파일로 구성되고 모든 파일은 m파일 형식으로 작성되었다.
1. 주실행 파일 : 모듈화된 영상 인식 및 주행 파일을 모아서 하나의 시스템으로 실행하는 파일
    - main.m

2. 목표점 탐색 파일 : 마커의 색과 대회장 환경을 인식하고 목표지점을 결정하는 파일
    - find_green_target.m
    - find_red_target.m

3. 전진 및 마커 명령 수행 파일 : 결정된 목표지점으로 전진하고 마커에 따른 명령을 수행하는 파일
    - moveforword_turn_green.m
    - moveforword_turn_red.m
    - findandmove_yellow.m

4. 이동량 계산 : 드론의 현재 위치와 계산된 목표점의 오차를 사용하여 이동량을 계산하여 드론을 이동시키는 파일
    - move_based_error.m

### 대회 진행 전략
대회를 진행하기 위한 전략은 크게 두가지의 원칙을 세우고 수행하였다. 
1. 한번에 목표점을 찾아가기보다는 단계별로 영상처리를 수행하여 목표점을 탐색하고 드론을 이동한다.
2. 영상처리의 경우 복잡한 조명과 다양한 기물이 존재할 수 있으므로 애매하고 하나의 상황에 최적화된 기법보다는 단순하고 강건한 영상처리 기법을 주로 사용한다.

### 알고리즘 설명
#### 목표점 탐색
목표점을 탐색하기위해 단계별로 접근하면서 드론을 움직이는 전략을 사용하였다. 
먼저 파랭색의 천이 존재하는 부분을 탐색하고 그 중심을 탐지하여 드론의 중심과 탐지된 파랑색의 천의 중심을 일치시켜서 드론이 점진적으로 파랑색 천의 중심으로 향하도록 하였다.
그 과정에서 원이 탐지되면 그 원의 중심을 향하여 드론을 이동시키고 최종적으로는 마커의 중심과 원의 중심을 일치시키는 방향으로 드론을 움직여서 목표점을 지정한다.
이동량의 계산은 드론의 중심과 탐지된 도형의 중심사이의 오차를 계산하여 스케일을 조정하여 드론의 명령으로 사용하였다. 
#### 전진 및 마커 명령 추종
목표점이 지정되면 마커의 중심을 향하여 전진명령을 드론에 전달한다. 만약 마커로 탐지된 픽셀의 개수가 지정된 개수 이상인 경우 마커의 명령을 추종하도록 알고리즘을 수행하였다. 
#### 임의 각도 회전 및 착륙
마지막 30~60도 사이의 임의의 각도로 회전하는 미션의 경우 먼저 45도로 회전후 노랑색의 착륙지점의 중심을 향하여 드론을 이동시키고 이후 착륙지점이 안보이는 구간에서는 파란색 천의 링의 중심을 탐지하여 각도를 변경하고 전진을 수행 한 후 원의 넓이가 일정한 값이상인 경우 착륙을 수행하도록 하였다.
