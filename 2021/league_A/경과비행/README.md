### 설명

## 1. 주행 알고리즘 및 주행경로
![png_1](https://user-images.githubusercontent.com/62247335/125641140-7d9c3d6d-7bee-49d8-bf3f-33a5baa1ad38.png)
저희는 대회를 준비하기 위해서 경기 트랙을 제작하여 위와 같은 경로로 주행하였습니다
경로 주행 밑에는 간략하게 작용되는 알고리즘을 적었습니다.

## 2. 색상 변환 알고리즘
저희는 파란색 값을 인식시키기 위해서 맨 처음에는 hsv로 색을 인식 시켰습니다.
통상적으로 h의 값이 0.55에서 0.78의 값 사이일 때 파란색의 범위에 들어가기에 초기에는 아래와 같은 코드를 작성하였으나 곧 너무 많은 값들이 주행할 때 마다 경기장 트랙을 제외한 밖의 부분이 다수 인식이 되어 주행방향에서 벗어나는 문제점을 발견하였습니다. 
 이후 이 점을 보완하기 위해 저희는 hsv의 검출을 포기하고 RGB의 변환을 통해 안정된 색 인식을 얻을 수 있었습니다.

![3-1](https://user-images.githubusercontent.com/62247335/125642648-a17a2ff2-7722-4b13-a91e-057960b18cf7.png)
## 3. 원형 검출 알고리즘
처음에는 저희가 원형을 검출하기 위해 파란색을 이미지 파일에서 얻은 후 색의 흑백반전을 통해 제대로 인식이 되었는지를 확인하고 레퍼지토리 내장함수인 imfindcircles을 이용하여 원의 경계면을 찾아 원으로 인식하면 이동을 하게끔 유도하려고 했으나 함수가 반전된 이미지의 원을 인식하지 못하거나 반전되지 않았더라도 sensitivity에 따른 원 인식의 민감도가 편차가 크게 변하여 작동에 문제가 생겼습니다.
![9](https://user-images.githubusercontent.com/62247335/125644169-d7b51537-228d-4e22-87ad-31932b9e34e9.png)
이를 해결하기 위해 다른 방법을 모색했고 찾은 방법이 아래의 코드입니다. 이미지 파일로부터 파란색을 인식한 뒤, 파란색 부분을 제외한 나머지 부분을 imfill함수를 이용하여 blue색상으로 채운 후 bw2에 저장시킵니다.
 저장한 변수 bw2가 실시간으로 정상적인 원으로 인식이 되고 있는지 figure와 imshow함수로
확인한 후 이를 blue의 변수에다 카메라의 최대 화소범위인 720과 960에 각 정보를 저장시킨 뒤, 실시간 변동을 위해 bw2는 다시 0으로 환원해줍니다. 이를 통해서 저희는 원형의 검출을 간단한 코드를 통해 할 수 있었습니다.
![5](https://user-images.githubusercontent.com/62247335/125642770-052227e5-b09b-4abe-8a71-8336275bd663.png)


## 4. 원 중심 찾기 알고리즘 및 전진 알고리즘
저희는 원의 중심을 찾기 전에 드론의 위치가 중심에 많이 벗어나 있으면 이후의 중심 축의 계산에서 오래 걸릴 것을 염려하여 처음에는 총 4구간을 나누어 인식하여 드론이 원형의 중심에 가깝게 이동하도록 계획하였습니다. 그래서 아래와 같이 드론의 카메라 인식의 범위를 원의 중앙에 가깝도록 위치하기 위해서 imcrop함수를 이용하였습니다. 먼저 픽셀의 가로를 절반으로 나누어 왼쪽과 오른쪽 중 어느 부분에 치우쳐있는지 판단 후 세로 부분의 절반을 나누어 파란색을 인식하여 표와 같은 4가지 부분 중 해당하는 부분에서 원 중심으로 향하도록 짰습니다.
 하지만 드론의 정보처리에 과부하가 걸려 정상적인 작동을 하지 않고 신호를 무시하는 오류가 발생하여 원래 4구간으로 나누어서 이동했던 방식을 바꾸어 적은 데이터를 주어 바꿀 수 있게끔  
Imcrop함수를 이용해 가로의 절반을 경계로 어느 쪽의 파란색 픽셀의 값이 더 많은 지 비교하여 이동하게끔 하고 이후에 세로 픽셀의 중간을 경계로 잘라 비교하여 상하의 위치를 조정하도록 했습니다.
![png_2](https://user-images.githubusercontent.com/62247335/125643398-eb342a0e-9f20-473e-99c1-0db6cb15e04b.png)
그 다음 이상적인 중점 값과 현재 드론이 있는 위치에서 측정하여 저장한 중점의 값을 비교하여 특정 오차 범위의 안까지 이동하여 중심 축으로 이동하게 코딩하였으며  정보의 처리로 인하여 움직임이 제한되는 것을 방지하기 위해서 일정 오차 범위 내에 있으면 반복문을 탈출하게끔 처리했습니다.
이후 이렇게 반복문을 탈출하면 맨 위에 for문을 통해서 level이라는 변수 값이 1씩 증가하게 작성했기 때문에 1단계와 2단계 일 때 자동으로 이동을 실행하게 만들었습니다. 


![7](https://user-images.githubusercontent.com/62247335/125642860-f3c76a97-d442-4ba5-9fc1-bc93128bea44.png)
![8](https://user-images.githubusercontent.com/62247335/125642889-01cfa0cc-e19f-485b-9507-97a1f1cc8a8e.png)

## 5. 회전 및 착지 알고리즘
지금까지 드론이 정상적으로 원을 인식하고 이동하여 착지하였으나 큰 문제는 따로 있었는데 바로 회전과 착지를 위한 인식입니다. 드론이 원에 너무 가까워지는 구간부터 통과하여 적정거리를 이동하는 구간에서는 드론이 링의 파란색 부분을 인식하지 못할정도로 가까워지는데다 빨간색 및 보라색을 인식하여 적정 위치에 도달해 정지한 후에 턴을 하는 거리를 생각하기 쉽지 않았습니다.
 그래서 처음에는 bounding box를 통해 레드 색상을 인식하고 이에 따라 x라는 변수의 가로 축의 값을 실시간으로 인식하여 멈추게하려고 했으나 너무 복잡하여 연산의 딜레이에 따른 작동오류가 생겨 아래의 코드와 같이 변경하였습니다. 
Sum을 통해 RGB값의 red를 저장한 변수 픽셀의 합이 400이 넘으면 앞으로 천천히 이동하는 것을 멈추고 왼쪽으로 90도 회전하게 설계하였으며, 이를 조정하는 변수 count를 처음에는 0의 값으로 전진하다가 400픽셀이 넘는 순간 count값을 1로 환원해주고 너무 가까운 거리의 인식 오류를 막고자 조금 뒤로 이동하게 만들었습니다. 보라색 또한 같은 메커니즘으로 작동하여 보라색을 인식 한 후에 착륙하도록 설계하였습니다.

이렇게 색 환원과 드론의 위치 및 중앙 미세 조정 알고리즘과 빨간색 및 보라색의 인식 후 작동 알고리즘을 통해 완주를 하였습니다.

![1](https://user-images.githubusercontent.com/62247335/125641839-5a07f398-b14c-4d80-9d95-213ec453d05a.PNG)
