

## 1. 대회전략

이번 대회의 주된 목적은 영상처리라고 생각합니다.
얼마나 정확하게 원링과 표식들을 인식하고 행동하는 것입니다.
저희 팀은 hsv를 이용하여 다른 사물들을 제외하고 원링만 정확하게 판별하여 링의 선을 따고 최대한 오차범위가 없는 좌표를 출력해서 이에 맞게 드론이 따라갈 수 있도록 하는 것입니다.
그리고 표식들도 다른 사물들을 제외하고 정확하게 판별하여 해당 표식에 적용되는 행동을 취하는 것입니다.
따라서 저희 팀의 주된 전략은 정확한 인식입니다.







## 2. 알고리즘 및 소스코드 설명

일단 저희팀은 1~3단계 모두 원링과 매 단계에 따른 마크를 인식하는 것이 중요하다고 생각했습니다.
이에 원의 중점을 찾아 원링을 통과한 후 마크를 기준으로 다음 단계로 동작할 수 있도록 전반적으로 알고리즘을 구성했습니다.

### (기본 원링통과 & 마크 인식 알고리즘)

먼저 원링을 통과하기 전 천을 통과하기 전까지 1~3m의 거리제한이 있으므로 드론은 가장먼저 1m를 이동하는 동작을 우선적으로 수행하게 됩니다.
그 뒤 파란천의 hsv 값에 bwareaopen, imfill를 적용해 드론의 카메라가 파란색의 임계값을 좀더 또렷하게 인식할 수 있도록 하였습니다.
가까운 거리에서는 링이 잘려 인식될 수도 있기 때문에 시작점으로부터 1m거리에서 링의 snapshot을 찍어서 전체적인 hole의 모습을 인식할 수 있도록 하였고, 
링의 전체적인 모습이 나온 상태에서 CannyEdge를 통해 edge에 해당되는 여러 점들을 구하였습니다. 
그 뒤 점들의 집합 중 max와 min값의 중간값을 통해 원의 중점을 구하였습니다.
원의 중점을 토대로 만약 드론이 통과해야하는 원링의 중앙보다 조금 오른쪽에 치우쳐있으면 좌측으로 0.2m 이동하는 등의 조건문을 추가로 적용하여 
최대한 원링의 중심으로 원을 통과할 수 있도록 알고리즘을 구성하였습니다.


원링 통과 시 원링뒤의 마크와 드론이 부딪힐 수도 있다는 점을 감안하여 1m만 추가로 이동하도록 하고 바로 마크가 인식하도록 하였습니다.
만일 드론의 출발지점과 원링의 거리가 3m가량 된다면 지금까지 드론이 이동한 거리는 총 2m이므로 드론이 원링을 완전히 통과하지 못할 수도 있다는 문제점이 발생할 수도 있습니다.
이를 방지하기 위해서 마크 인식시, 일정 크기 이상 마크가 인식되었을때만 다음단계로 진행할 수 있도록 알고리즘을 구성하였습니다. 
저희는 드론의 카메라로 인식했을때 마크의 크기가 가로 30cm X 세로 30cm 일때 드론이 다음 동작이 가능한 크기라고 생각했기에 이 범위에 이르기까지 드론을 0.5m씩 추가로 전진하도록 했고, 마크가 해당 크기보다 크게 인식됐을 때 다음단계로 진행하도록 하였습니다.



3단계 모두 위의 알고리즘을 토대로 구성하였으며, 2, 3단계와 같은 경우에는 파란천의 높이와 좌우가 달라지는 조건이 있었기에 코드를 몇가지 추가해주었습니다.

![영상처리 화면](https://user-images.githubusercontent.com/82217475/178765377-35e30f2d-90fc-4a5d-80f3-bf3248f552fc.png)


![드론 흐름도](https://user-images.githubusercontent.com/82217475/178762730-f65b40b6-3f0b-40fb-bab1-e663d9217430.png)








### (2, 3단계 높이, 좌우 조절에 따른 알고리즘)

1단계 마크를 보고 회전후 일단 1m 전진을 기본적으로 수행해줍니다.
그 뒤 드론은 총 세 번의 중간지점의 snapshot을 찍게되는데 이는 링이 양옆으로 각 2m씩, 상하로 0~150cm의 이동이 있을 수 있기때문에 이 파란천을 찾기 위한 전략입니다.
드론의 움직임을 최소화와 시간절약을 위해 크게 정면, 좌, 우 총 세 번의 사진만 찍도록 하고, 파란색이 하나라도 인식되었을 때 해당 부분을 집중적으로 탐색하는 방식으로 아이디어를 구성했습니다. 가장먼저 정면의 사진을 찍어주고 해당 사진에 파란색이 인식되지 않을 때 좌측으로 이동합니다. 좌측에서도 파란색이 보이지 않을 시 우측으로 이동하여 드론은 파란 링을 찾게됩니다. 

최악의 경우 가장 좌측, 150cm높이에 링이 있다고 가정하면 드론은 정면에 파란링이 없음을 가정하고 좌측으로 이동하여 해당 사진에 파란링의 유무를 찾게됩니다.
파란링이 존재함을 인식했을 때 사진을 가운데 중점을 기준으로 4분면으로 나눈 후 파란색이 어디에서 인식되었는지 확인하고 해당방향으로 이동하게됩니다.
위의 가정대로라면 파란색은 드론이 찍은 snapshot 위쪽에서 탐지되어야 할 것이고, 조건문에 따라 드론은 위쪽으로 이동하게 될 것입니다.
어느정도 링쪽으로 이동했으면 다시 위의 기본 알고리즘을 수행하며 원링의 중점을 찾을 것이고, 구멍을 통과한 뒤 마크를 인식하고 다음단계로 이동하게 될 것입니다.





2번째 알고리즘 같은 경우는 위와 같이 알고리즘을 구상하였으나 
팀원들이 모두 코로나에 걸리는 바람에 외부로의 출입을 할 수가 없어 직접 드론을 조종하지 못하게 돼, 직접 드론 동작을 수행할 수 없었습니다.
이에 비록 코드로는 완벽히 재현하지 못하였지만, 저희 팀이 그간 구상한 아이디어는 함께 적어 제출합니다. 





