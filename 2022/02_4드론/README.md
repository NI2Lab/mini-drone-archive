# 4드론 기술워크숍
## 4드론 대회진행전략
4드론의 대회진행전략은 '기초부터 차근차근' 을 모토로 대회진행전략을 세웠습니다. 1차, 2차, 3차 워크샵 영상을 토대로 기본으로 설명해주신
내용을 충분히 실습을 통해 이해한 후, 응용을 통해서 원하는 목표를 달성할 수 있는 코드를 만들자는 전략을 세웠습니다. 
비록, 우리가 원하는 코드가 잘 실행되지 않더라도 포기하지 않고 원하는 목표를 이룰 수 있을 때까지 끝까지 도전하려 했습니다.

## 4드론 알고리즘
4드론의 알고리즘은 드론 객체 선언 > 띄우기 > 원 찾기 > 원의 중앙좌표로 이동 > 원을 통과 > 표식 찾기 단계로 구성했습니다.

### 알고리즘 1단계 - 드론 객체 선언
워크숍 영상을 토대로 ryze()를 이용해서 드론 객체를 선언한 후, 드론 카메라 객체를 선언했습니다.

### 알고리즘 2단계 - 띄우기
takeoff 함수로 드론을 이륙시킵니다.

### 알고리즘 3-1단계 - 원 찾기
통과하기 위한 원을 찾는 단계입니다. 이번 대회에서 주어진 색(파란색)의 hsv값을 추출하여 해당 색을 같는 원을 인식한 후 정확히 가운데 원을 추출하기 위해서 가운데 공간 빈 공간을 메꾼 후 기존값과 비교하여 달라진 부분은 1로, 그대로인 부분은 0으로 표시하게 하였습니다. 이렇게하여 정확한 가운데 원을 찾을 수 있습니다.

### 알고리즘 3-2단계 - 원의 중앙좌표로 이동
목표 원을 인식한 후 원의 가운데 좌표 값과 화면 전체의 가운데 좌표 값을 비교하여 두 값이 오차 범위를 벗어나 있으면 move함수를 이용하여 두 값의 차이가 오차 범위 내로 들어올 때 까지 상하 좌우로 움직입니다. 

### 알고리즘 3-3단계, 원을 통과
드론이 원의 중앙좌표로 위치하였다고 판단되면 moverforward 함수를 이용하여 원을 통과하게 합니다. 이때 원의 픽셀값을 계산하여 0이 될 때까지 전진하게 합니다.
w
### 알고리즘 4단계, 표식 찾기
새로운 변수를 정의해서 이미지 프레임을 수집한 후, 각각의 표식에 맞는 값을 찾게 된다면 주최측에서 제시한 표식의 명령에 맞게 이동합니다.

## 4드론 코드 설명
4드론은 regionprops외에는 어려운 함수를 사용하지 않고 논리적 전개에 의하여 드론을 제어하였습니다.

### 원 인식 코드
rgb2hsv 함수를 이용하여 snapshot으로 드론이 찍은 사진을 hsv값으로 변경시켜줍니다. 이후 우리가 원하는 색의 hsv값을 찾아내어 해당 값만 추출합니다.
예를들어 초록색에 해당하는 hsv값을 찾기 위하여 드론으로 사진을 찍어 샘플링 하였습니다. 이후 우리가 원하는 초록색 값이 (0.37<h)&(h<0.48)&(s>0.4)&(v>0.1)&(v<0.9) 에 해당한다는 사실을 알게 되었습니다.
이후 우리가 원하는 색의 원의 정 중앙값을 알아내기 위하여 imfill 함수를 사용하여 원의 중앙값을 1로 바꾸어줍니다. 그리고 equal 함수를 사용하여 기존의 원 사진과 imfill 이후의 사진을 비교하여 값이 바뀐 부분(원의 정 중앙)은 1의 값으로, 바뀌지 않은 부분(원의 겉 값)은 0의 값으로 표현하여 정확한 원의 값 만을 표시해 줍니다.

### 원의 중앙좌표 찾기 코드
다음으로 regionprops를 이용해서 각 객체의 속성을 반환합니다. 이진 영상인 Bluehole을 입력 후에 각각의 출력값인 Centroid, Area, Image, BoundingBox를 반환합니다. 
다음으로 if 구문을 통해 조건 수식을 세웁니다. 드론이 원의 중앙에 있는지 확인하기 위하여 사진의 전체 픽셀 720x960의 해상도의 중앙좌표인 (360x480)에서 우리가 자체적으로 생각한 허용마진 50x50을 더하여 원의 중앙값과 비교를 합니다. 그러기 위하여 현재의 x좌표 값 + y좌표 값을 중앙좌표값 360+480으로 나누어 마진을 넘어선 값 (840+50+50)/840=1.12 이상 혹은 (840-50-50)/840=0.881 이하가 된다면 move 함수를 통하여 드론을 움직이게 합니다.

### 드론 이동 코드
현재 드론의 위치가 원의 중앙에서 얼마나 벗어났는지 알면 그 다음으로 드론이 얼마나 이동하여야 하는지를 계산합니다.
centroid 함수를 이용하여 계산한 원의 중앙값을 중앙좌표값에서 빼면 드론이 중앙좌표에서 얼마나 벗어나 있는지 알 수 있습니다.
그러면 벗어난 위치만큼 move 함수를 발동하여 드론을 중앙좌표에 맞춰줍니다.

### 표식 찾기 코드
rgb2hsv 함수를 이용하여 snapshot으로 드론이 찍은 사진을 hsv값으로 변경시켜줍니다. 각각의 표시를 이용해 찾기 위해서 변수를 세운 후, 표식을 인식했을 때 각각의 표식이 명령하는 것을 코딩으로 작성합니다. 예시로, 90도 이동의 경우 turn(dronee,deg2rad(90)) 명령어를 사용합니다. 따라서 빨간색, 파랑색, 초록색 점을 인식하게 되는 코드를 각각 사용합니다. 

# 마치며
따라서, 코드 설명에서 원 인식, 원의 중앙좌표 찾기, 표식 찾기를 적절히 이용해서 트랙을 완주하는 것이 저희 4드론 팀의 목표입니다. 
